---
title: "Demo George"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Demo George}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
author: George G. Vega Yon
date: 2024-07-30
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup-package}
library(branchingprocess)
```

Say there are 30 H5N1 human infections from zoonotic spillover events, i.e. 30 instances of human infection from exposure to animals. In 25 of the spillover events, no subsequent human-to-human occurred. In 3 of the spillover events, exactly one human-to-human transmission occurred from the initially infected human with no further transmission (final size of 2 infections). In one spillover event, there was an outbreak of final size 10 infections, and another spillover event produced an outbreak of final size 50 infections. What values of R and k would best characterize this set of observations?

We can make use of the pFinalSize function to create a (log) likelihood function for this dataset of outbreak clusters. First, pClusterSizes calculates the probabilities of the four different final sizes observed (1, 2, 10, and 50) for given values of R and k:

```{r}
pClusterSizes <- function(R,k) pFinalSize(1,c(1,2,20,50),R,k)
```

Then use the function logLikData to calculate the log likelihood of observing 25, 3, 1, and 1 outbreak(s) of those four sizes, for given values of R and k:

```{r}
logLikData <- function(R,k) sum(c(25,3,1,1)*log(pClusterSizes(R,k)))
```

Then calculate the maximum likelihood R and k by optimizing the log likelihood:

```{r}
maxLikelihoodEstimate <- optim(f = function(x) ifelse(all(x>0), -logLikData(x[1],x[2]), Inf), par = c(R=1,k=1))$par

maxLikelihoodEstimate
```

The maximum likelihood estimate is R = 0.8, k = 0.08. For these values, what is the probability that a singles spillover event will result in an outbreak of 100 or more cases?

```{r}
p100 <- 1-sum(pFinalSize(1,1:99,0.8,0.08))
p100
```

 


